#!/bin/bash

# Kiá»ƒm tra quyá»n root
if [ "$EUID" -ne 0 ]; then
    echo "âŒ Vui lÃ²ng cháº¡y script báº±ng quyá»n root."
    exit 1
fi

# CÃ i Ä‘áº·t dante-server
apt update -y && apt install -y dante-server pwgen

# Táº¡o user/pass ngáº«u nhiÃªn
user="user$(shuf -i 1000-9999 -n 1)"
pass=$(pwgen 10 1)

# ThÃªm user vÃ o há»‡ thá»‘ng
useradd -M -s /usr/sbin/nologin "$user"
echo "$user:$pass" | chpasswd

# Táº¡o file cáº¥u hÃ¬nh cho dante
cat > /etc/danted.conf <<EOF
logoutput: /var/log/danted.log

internal: 0.0.0.0 port = 6969
external: eth0

method: username

client pass {
    from: 0.0.0.0/0 to: 0.0.0.0/0
    log: connect disconnect error
}

pass {
    from: 0.0.0.0/0 to: 0.0.0.0/0
    protocol: tcp udp
    log: connect disconnect error
    method: username
}
EOF

# Tá»± Ä‘á»™ng tÃ¬m interface náº¿u eth0 khÃ´ng tá»“n táº¡i
iface=$(ip route | grep default | awk '{print $5}' | head -n1)
sed -i "s/external: eth0/external: $iface/" /etc/danted.conf

# Báº­t dá»‹ch vá»¥ Dante
cat > /etc/systemd/system/danted.service <<EOF
[Unit]
Description=Dante SOCKS5 Proxy
After=network.target

[Service]
Type=simple
ExecStart=/usr/sbin/danted -f /etc/danted.conf
Restart=always

[Install]
WantedBy=multi-user.target
EOF

# Khá»Ÿi Ä‘á»™ng dá»‹ch vá»¥
systemctl daemon-reexec
systemctl daemon-reload
systemctl enable danted
systemctl restart danted

# Láº¥y IP public
ip=$(curl -s ifconfig.me)

# Hiá»ƒn thá»‹ thÃ´ng tin proxy SOCKS5
echo ""
echo "âœ… SOCKS5 Proxy Ä‘Ã£ Ä‘Æ°á»£c thiáº¿t láº­p thÃ nh cÃ´ng!"
echo "--------------------------------------------"
echo "ðŸ”Œ Host    : $ip"
echo "ðŸ“ Port    : 6969"
echo "ðŸ‘¤ User    : $user"
echo "ðŸ”‘ Pass    : $pass"
echo "ðŸŒ Proxy   : socks5://$user:$pass@$ip:6969"
echo "--------------------------------------------"
